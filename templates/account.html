{% extends "base.html" %}
{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between mb-4 gap-3">
  <div>
    <h1 class="h3 mb-0 fw-bold">Account Settings</h1>
    <div class="text-muted small">Update your password.</div>
  </div>
  <a class="btn btn-outline-secondary" href="/">
    <i class="bi bi-arrow-left"></i> Back to Dashboard
  </a>
</div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}
{% if success %}
  <div class="alert alert-success">{{ success }}</div>
{% endif %}

<div class="card shadow-sm">
  <div class="card-body">
    <form method="post" action="/account/password" class="row g-3">
      <div class="col-12">
        <label class="form-label">Current Password</label>
        <input class="form-control" type="password" name="current_password" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">New Password</label>
        <input class="form-control" type="password" name="new_password" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Confirm New Password</label>
        <input class="form-control" type="password" name="confirm_password" required>
      </div>
      <div class="col-12">
        <button class="btn btn-primary" type="submit">
          <i class="bi bi-check-circle"></i> Update Password
        </button>
      </div>
    </form>
  </div>
</div>

<div class="card shadow-sm mt-4">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
      <div>
        <h5 class="mb-0">API Tokens</h5>
        <div class="text-muted small">Generate a token for API access (shown once).</div>
      </div>
    </div>
    {% if api_token %}
      <div class="alert alert-warning">
        <div class="fw-semibold">Your new token:</div>
        <code>{{ api_token }}</code>
      </div>
    {% endif %}
    <form method="post" action="/account/api-tokens" class="row g-3 align-items-end">
      <div class="col-md-6">
        <label class="form-label">Label (optional)</label>
        <input class="form-control" type="text" name="label" placeholder="e.g. Mobile App">
      </div>
      <div class="col-md-3">
        <button class="btn btn-outline-primary w-100" type="submit">
          <i class="bi bi-key"></i> Create Token
        </button>
      </div>
    </form>
    <div class="table-responsive mt-3">
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Prefix</th>
            <th>Label</th>
            <th>Created</th>
            <th>Last Used</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for token in tokens or [] %}
            <tr>
              <td><code>{{ token.token_prefix }}</code></td>
              <td>{{ token.label or '—' }}</td>
              <td class="small text-muted">{{ token.created_at|dtfmt }}</td>
              <td class="small text-muted">{{ token.last_used_at|dtfmt if token.last_used_at else '—' }}</td>
              <td class="text-end">
                <form method="post" action="/account/api-tokens/{{ token.id }}/revoke" onsubmit="return confirm('Revoke this token?');">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Revoke</button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted small">No API tokens created yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-4">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h5 class="mb-1">Push Notifications</h5>
        <div class="text-muted small">Enable browser notifications for alerts.</div>
      </div>
      <button class="btn btn-outline-primary js-enable-browser-alerts" type="button" data-status-target="account-alerts-status">
        <span id="account-alerts-status">Off</span>
      </button>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-4">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h5 class="mb-1">Sign out</h5>
        <div class="text-muted small">Log out of your Reef Metrics account.</div>
      </div>
      <a class="btn btn-outline-danger" href="/auth/logout">
        <i class="bi bi-box-arrow-right"></i> Logout
      </a>
    </div>
  </div>
</div>
{% endblock %}
