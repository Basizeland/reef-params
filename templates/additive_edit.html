{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <h2 class="h5 mb-1">{% if additive %}Edit additive{% else %}New additive{% endif %}</h2>
        <div class="text-muted small">Strength is defined as: 1 mL per 100 L changes the parameter by X.</div>
      </div>
      <a class="btn btn-outline-secondary" href="/additives">Back</a>
    </div>

    <form method="post" action="/additives/save" class="mt-3">
      {% if additive %}
        <input type="hidden" name="additive_id" value="{{ additive.id }}" />
      {% endif %}

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <label class="form-label">Name</label>
          <input class="form-control" name="name" value="{{ additive.name if additive else '' }}" required />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Brand</label>
          <input class="form-control" name="brand" value="{{ additive.brand if additive and additive.brand is not none else '' }}" placeholder="e.g. Tropic Marin" />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Parameter</label>
          <select class="form-select" name="parameter" required>
            {% for p in parameters %}
              <option value="{{ p.name }}" {% if (additive and additive.parameter == p.name) or (not additive and selected_parameter and selected_parameter == p.name) %}selected{% endif %}>{{ p.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label">Concentration (mg/L)</label>
          <input class="form-control" name="strength" type="number" step="any" value="{{ additive.strength|string if additive and additive.strength is not none else '' }}" required />
          <div class="form-text">Enter the additive concentration in mg/L.</div>
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label">Unit</label>
          <input class="form-control" name="unit" value="{{ additive.unit if additive else '' }}" required placeholder="e.g. dKH, ppm" />
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label">Max daily change (in parameter units)</label>
          <input class="form-control" name="max_daily" type="number" step="any" value="{{ additive.max_daily if additive and additive.max_daily is not none else '' }}" />
        <div class="form-text">Leave blank to use the parameter's default daily limit (set under Settings â†’ Parameters).</div>
        </div>

        <div class="col-12">
          <label class="form-label">Notes</label>
          <textarea class="form-control" name="notes" rows="3">{{ additive.notes if additive and additive.notes else '' }}</textarea>
        </div>

        <div class="col-12">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="active" id="active" {% if not additive or additive.active %}checked{% endif %}>
            <label class="form-check-label" for="active">Active</label>
          </div>
        </div>

        <div class="col-12 d-flex gap-2">
          <button class="btn btn-primary" type="submit">Save</button>
          <a class="btn btn-outline-secondary" href="/additives">Cancel</a>
        </div>
      </div>
    </form>

    {% if additive %}
    <form class="mt-3" method="post" action="/additives/{{ additive.id }}/delete" onsubmit="return confirm('Delete this additive?')">
      <button class="btn btn-outline-danger" type="submit">Delete additive</button>
    </form>
    {% endif %}
  </div>
</div>
{% endblock %}
