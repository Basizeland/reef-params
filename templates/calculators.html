{% extends "base.html" %}
{% block content %}
<h2>Dosing Calculator</h2>
<div class="card p-4 shadow-sm">
  <form method="post">
    <div class="mb-3">
      <label class="form-label">Select Tank</label>
      <select name="tank_id" class="form-select">
        {% for t in tanks %}
        <option value="{{ t.id }}" {% if selected and selected.tank_id == t.id %}selected{% endif %}>{{ t.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Select Additive</label>
      <select name="additive_id" class="form-select">
        {% for a in additives %}
        <option value="{{ a.id }}" {% if selected and selected.additive_id == a.id %}selected{% endif %}>{{ a.name }} ({{ a.strength }} {{ a.unit }})</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Desired Change (e.g. 10 ppm)</label>
      <input type="number" step="any" name="desired_change" class="form-control" value="{{ result.desired_change if result else '' }}" required>
    </div>
    <button type="submit" class="btn btn-primary">Calculate</button>
  </form>
  {% if result %}
    <div class="alert alert-success mt-4">
      <h4 class="alert-heading">Results</h4>
      <p>To raise <strong>{{ result.tank.name }}</strong> by <strong>{{ result.desired_change }}</strong>:</p>
      <ul>
        <li>Total Dose: <strong>{{ result.dose_ml|fmt2 }} ml</strong></li>
        {% if result.days > 1 %}
        <li>Safe limit requires <strong>{{ result.days }} days</strong>.</li>
        <li>Daily Dose: <strong>{{ result.daily_ml|fmt2 }} ml</strong>/day.</li>
        {% endif %}
      </ul>
    </div>
  {% endif %}
</div>
{% endblock %}
