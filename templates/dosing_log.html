{% extends "base.html" %}
{% block content %}
<div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
  <div>
    <h1 style="margin:0;">Dosing log</h1>
    <div style="opacity:.8;">{{ tank.name }}</div>
  </div>
  <a class="btn" href="/tanks/{{ tank_id }}">Back</a>
</div>

<div class="card" style="padding:16px; margin-top:16px;">
  <h2 style="margin:0 0 10px;">Add entry</h2>
  <form method="post" action="/tanks/{{ tank_id }}/dosing-log" style="display:grid; grid-template-columns: 1fr 140px 2fr 120px; gap:10px; align-items:end;">
    <div>
      <label>Additive</label>
      <select name="additive_id">
        <option value="">(none)</option>
        {% for a in additives %}
          <option value="{{ a.id }}">{{ a.name }} â€” {{ a.parameter }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Amount (mL)</label>
      <input name="amount_ml" type="number" step="any" required />
    </div>
    <div>
      <label>Reason / Notes</label>
      <input name="reason" />
    </div>
    <div>
      <button class="btn" type="submit">Add</button>
    </div>
  </form>
</div>

<div class="card" style="padding:16px; margin-top:16px;">
  <h2 style="margin:0 0 10px;">History</h2>
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(0,0,0,.1);">Time</th>
        <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(0,0,0,.1);">Additive</th>
        <th style="text-align:right; padding:8px; border-bottom:1px solid rgba(0,0,0,.1);">mL</th>
        <th style="text-align:left; padding:8px; border-bottom:1px solid rgba(0,0,0,.1);">Reason</th>
        <th style="text-align:right; padding:8px; border-bottom:1px solid rgba(0,0,0,.1);"> </th>
      </tr>
    </thead>
    <tbody>
      {% for l in logs %}
      <tr>
        <td style="padding:8px; border-bottom:1px solid rgba(0,0,0,.06);">
          {% if l.logged_at_dt and l.logged_at_dt.strftime is defined %}
            {{ l.logged_at_dt.strftime("%Y-%m-%d %H:%M") }}
          {% else %}
            {{ l.logged_at }}
          {% endif %}
        </td>
        <td style="padding:8px; border-bottom:1px solid rgba(0,0,0,.06);">{{ l.additive_name or "" }}</td>
        <td style="padding:8px; border-bottom:1px solid rgba(0,0,0,.06); text-align:right;">{{ l.amount_ml }}</td>
        <td style="padding:8px; border-bottom:1px solid rgba(0,0,0,.06);">{{ l.reason or "" }}</td>
        <td style="padding:8px; border-bottom:1px solid rgba(0,0,0,.06); text-align:right;">
          <form method="post" action="/dose-logs/{{ l.id }}/delete" onsubmit="return confirm('Delete this dosing entry?');" style="display:inline;">
            <input type="hidden" name="tank_id" value="{{ tank_id }}">
            <button class="btn" type="submit">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
      {% if not logs %}
      <tr><td colspan="5" style="padding:12px; opacity:.8;">No dosing entries yet.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
