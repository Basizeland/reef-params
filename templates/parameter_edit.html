{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h5 mb-0">{% if param %}Edit Parameter{% else %}New Parameter{% endif %}</h2>
      <a class="btn btn-outline-secondary" href="/settings/parameters">Back</a>
    </div>

    <form method="post" action="/settings/parameters/save">
      {% if param %}
        <input type="hidden" name="param_id" value="{{ param.id }}" />
      {% endif %}

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <label class="form-label fw-bold">Name</label>
          <input class="form-control" name="name" value="{{ param.name if param else '' }}" required placeholder="e.g. Alkalinity" />
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label fw-bold">Unit</label>
          <input class="form-control" name="unit" value="{{ param.unit if param and param.unit else '' }}" placeholder="e.g. ppm" />
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label fw-bold">Sort Order</label>
          <input class="form-control" name="sort_order" type="number" value="{{ param.sort_order if param else '0' }}" />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label fw-bold">Max Daily Change Safe Limit</label>
          <input class="form-control" name="max_daily_change" type="number" step="any" value="{{ param.max_daily_change if param and param.max_daily_change is not none else '' }}" />
          <div class="form-text">Used in calculators to warn if a dose is too large.</div>
        </div>

        <div class="col-12">
          <hr class="my-2">
          <h6 class="mb-3 text-primary">Recommended Defaults (for new tanks)</h6>
          <div class="row g-3">
            <div class="col-6 col-md-3">
              <label class="form-label small">Target Low</label>
              <input class="form-control form-control-sm" name="default_target_low" type="number" step="any" value="{{ param.default_target_low if param and param.default_target_low is not none else '' }}">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label small">Target High</label>
              <input class="form-control form-control-sm" name="default_target_high" type="number" step="any" value="{{ param.default_target_high if param and param.default_target_high is not none else '' }}">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label small">Alert Low</label>
              <input class="form-control form-control-sm" name="default_alert_low" type="number" step="any" value="{{ param.default_alert_low if param and param.default_alert_low is not none else '' }}">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label small">Alert High</label>
              <input class="form-control form-control-sm" name="default_alert_high" type="number" step="any" value="{{ param.default_alert_high if param and param.default_alert_high is not none else '' }}">
            </div>
          </div>
          <hr class="my-2">
        </div>

        <div class="col-12">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="active" id="active" {% if not param or param.active %}checked{% endif %}>
            <label class="form-check-label" for="active">Active (visible in lists)</label>
          </div>
        </div>

        <div class="col-12 mt-4 d-flex gap-2">
          <button class="btn btn-primary" type="submit">Save Parameter</button>
          <a class="btn btn-outline-secondary" href="/settings/parameters">Cancel</a>
        </div>
      </div>
    </form>

    {% if param %}
    <div class="mt-5 pt-3 border-top">
      <form method="post" action="/settings/parameters/{{ param.id }}/delete" onsubmit="return confirm('Delete this parameter? This will remove all associated history and targets.');">
        <button class="btn btn-sm btn-outline-danger" type="submit">Delete Parameter</button>
      </form>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
